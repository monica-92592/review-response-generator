"use strict";(()=>{var e={};e.id=910,e.ids=[910],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},5315:e=>{e.exports=require("path")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},2623:e=>{e.exports=require("worker_threads")},1568:e=>{e.exports=require("zlib")},7561:e=>{e.exports=require("node:fs")},4492:e=>{e.exports=require("node:stream")},2477:e=>{e.exports=require("node:stream/web")},6949:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>H,patchFetch:()=>Y,requestAsyncStorage:()=>U,routeModule:()=>X,serverHooks:()=>B,staticGenerationAsyncStorage:()=>K});var r={};s.r(r),s.d(r,{DELETE:()=>V,GET:()=>$,POST:()=>D,PUT:()=>_});var n=s(9303),i=s(8716),a=s(670),o=s(7070),c=s(4214),l=s(7534);let u=(e,t)=>{let s;let r=e.toLowerCase(),n=parseInt(t),i=["great","excellent","amazing","wonderful","fantastic","outstanding","perfect","love","awesome","best","good","nice","happy","satisfied","pleased","impressed","recommend","exceeded","surpassed","delighted"].filter(e=>r.includes(e)).length,a=["terrible","awful","horrible","worst","bad","poor","disappointed","unhappy","frustrated","angry","upset","disgusted","hate","never","avoid","waste","ripoff","scam","useless","broken","failed"].filter(e=>r.includes(e)).length,o=["okay","fine","average","decent","acceptable","adequate","mediocre","ordinary","standard","normal","typical"].filter(e=>r.includes(e)).length,c="neutral";n>=4?c="positive":n<=2&&(c="negative");let l=.5;return i>a&&i>o?(s="positive",l=Math.min(.9,.5+.1*i)):a>i&&a>o?(s="negative",l=Math.min(.9,.5+.1*a)):o>i&&o>a?(s="neutral",l=Math.min(.9,.5+.1*o)):(s="mixed",l=.6),"positive"===s&&"positive"===c||"negative"===s&&"negative"===c?l=Math.min(.95,l+.2):s!==c&&(l=Math.max(.3,l-.2)),{sentiment:s,confidence:l,keyTopics:d(r),emotions:p(r)}},d=e=>{let t=[];return(e.includes("service")||e.includes("staff")||e.includes("employee"))&&t.push("customer service"),(e.includes("food")||e.includes("meal")||e.includes("dish"))&&t.push("food quality"),(e.includes("price")||e.includes("cost")||e.includes("expensive")||e.includes("cheap"))&&t.push("pricing"),(e.includes("clean")||e.includes("dirty")||e.includes("hygiene"))&&t.push("cleanliness"),(e.includes("wait")||e.includes("time")||e.includes("slow")||e.includes("fast"))&&t.push("speed/efficiency"),(e.includes("atmosphere")||e.includes("ambiance")||e.includes("environment"))&&t.push("atmosphere"),(e.includes("location")||e.includes("parking")||e.includes("access"))&&t.push("location/accessibility"),t.length>0?t:["general experience"]},p=e=>{let t=[];return(e.includes("happy")||e.includes("joy")||e.includes("excited"))&&t.push("happy"),(e.includes("angry")||e.includes("furious")||e.includes("mad"))&&t.push("angry"),(e.includes("sad")||e.includes("disappointed")||e.includes("upset"))&&t.push("sad"),(e.includes("surprised")||e.includes("shocked")||e.includes("amazed"))&&t.push("surprised"),(e.includes("frustrated")||e.includes("annoyed")||e.includes("irritated"))&&t.push("frustrated"),(e.includes("grateful")||e.includes("thankful")||e.includes("appreciate"))&&t.push("grateful"),t},m=e=>{let t=u(e.text,e.rating),s=h(e.businessType,t),r=g(e.tone,t,e.toneAdjustments),n=y(e.responseLength,t),i=f(t),a=R(e.variation),o=k(e.useTemplate);return{system:`You are an expert customer service representative with deep knowledge of ${e.businessType} businesses. Your role is to craft authentic, contextually appropriate responses to customer reviews.

${s}

${r}

${i}

${a}

${o}

Key Guidelines:
- Address specific feedback mentioned in the review
- Acknowledge the customer's experience and emotions
- Provide appropriate solutions or acknowledgments
- Maintain brand voice and professionalism
- Encourage future engagement when appropriate
- Keep responses genuine and personalized

${n}

Always respond with just the review response text, no additional formatting or explanations.`,user:`Review: "${e.text}"
Rating: ${e.rating} stars
Sentiment Analysis: ${t.sentiment} (confidence: ${Math.round(100*t.confidence)}%)
Key Topics: ${t.keyTopics.join(", ")}
Emotions Detected: ${t.emotions.length>0?t.emotions.join(", "):"neutral"}

Please write a response that addresses the specific feedback while maintaining the appropriate tone and length.`,maxTokens:v(e.responseLength,t),temperature:w(t,e.tone,e.variation)}},h=(e,t)=>{let s={restaurant:`Restaurant/food service business context:
- Focus on food quality, taste, presentation, and freshness
- Consider service speed, staff friendliness, and attentiveness
- Address atmosphere, cleanliness, and dining experience
- Acknowledge pricing, portion sizes, and value for money
- Consider dietary restrictions and special requests`,retail:`Retail/e-commerce business context:
- Focus on product quality, selection, and availability
- Consider customer service, staff knowledge, and helpfulness
- Address shopping experience, store layout, and convenience
- Acknowledge pricing, promotions, and value
- Consider return policies and after-sales support`,healthcare:`Healthcare/medical business context:
- Focus on patient care, medical expertise, and professionalism
- Consider communication, empathy, and bedside manner
- Address wait times, appointment scheduling, and accessibility
- Acknowledge facility cleanliness and safety
- Consider follow-up care and patient education`,professional:`Professional services business context:
- Focus on expertise, reliability, and professional standards
- Consider communication, responsiveness, and attention to detail
- Address project delivery, timelines, and quality of work
- Acknowledge pricing, value, and return on investment
- Consider ongoing support and relationship building`,hospitality:`Hospitality/travel business context:
- Focus on guest experience, accommodations, and amenities
- Consider staff hospitality, local knowledge, and service quality
- Address cleanliness, comfort, and safety
- Acknowledge location, accessibility, and value
- Consider special requests and personalized service`,technology:`Technology/software business context:
- Focus on product functionality, reliability, and user experience
- Consider technical support, documentation, and ease of use
- Address performance, features, and innovation
- Acknowledge pricing, licensing, and value
- Consider updates, maintenance, and customer success`,other:`General business context:
- Focus on overall customer satisfaction and service quality
- Consider all aspects of the customer experience
- Address specific feedback and concerns raised
- Acknowledge business strengths and areas for improvement
- Consider customer relationship and future engagement`};return s[e]||s.other},g=(e,t,s)=>{let r={professional:`Professional tone requirements:
- Use formal, business-appropriate language
- Maintain courteous and respectful communication
- Demonstrate expertise and competence
- Be diplomatic and solution-oriented
- Avoid overly casual or emotional language`,friendly:`Friendly tone requirements:
- Use warm, approachable, and personable language
- Show genuine interest and care for the customer
- Be conversational while maintaining professionalism
- Use positive and encouraging language
- Create a welcoming and comfortable atmosphere`,formal:`Formal tone requirements:
- Use very formal, corporate-level language
- Maintain strict professional standards
- Be respectful and proper in all communications
- Use traditional business etiquette
- Avoid any casual or informal expressions`,casual:`Casual tone requirements:
- Use relaxed, conversational, and informal language
- Be approachable and easy-going
- Use everyday language that feels natural
- Maintain friendliness without being overly formal
- Create a comfortable, laid-back atmosphere`,empathetic:`Empathetic tone requirements:
- Show deep understanding and compassion
- Acknowledge and validate customer feelings
- Use supportive and caring language
- Demonstrate emotional intelligence
- Provide comfort and reassurance when appropriate`},n=r[e]||r.professional;return"negative"===t.sentiment?n+="\n\nSpecial considerations for negative feedback:\n- Show extra empathy and understanding\n- Acknowledge the customer's concerns sincerely\n- Focus on solutions and improvements\n- Demonstrate commitment to better service":"positive"===t.sentiment&&(n+="\n\nSpecial considerations for positive feedback:\n- Express genuine gratitude and appreciation\n- Reinforce positive experiences\n- Encourage continued engagement\n- Share the positive feedback with the team"),s&&(s.formality&&(n+=`

Formality adjustment: ${s.formality}`),s.empathy&&(n+=`

Empathy adjustment: ${s.empathy}`),s.enthusiasm&&(n+=`

Enthusiasm adjustment: ${s.enthusiasm}`),s.professionalism&&(n+=`

Professionalism adjustment: ${s.professionalism}`)),n},f=e=>{switch(e.sentiment){case"positive":return`Positive Review Strategy:
- Express genuine gratitude and appreciation
- Reinforce the positive aspects mentioned
- Share how the feedback motivates the team
- Encourage continued patronage and referrals
- Highlight commitment to maintaining high standards`;case"negative":return`Negative Review Strategy:
- Acknowledge the customer's experience sincerely
- Show understanding of their concerns
- Provide specific solutions or improvements
- Demonstrate commitment to better service
- Offer appropriate compensation or resolution when warranted`;case"neutral":return`Neutral Review Strategy:
- Thank the customer for their balanced feedback
- Acknowledge both positive and negative aspects
- Show commitment to improvement in areas mentioned
- Encourage future engagement to provide better experiences`;case"mixed":return`Mixed Review Strategy:
- Acknowledge the complexity of their experience
- Thank them for the positive aspects
- Address concerns with specific solutions
- Show appreciation for their detailed feedback
- Demonstrate commitment to improvement`;default:return`General Strategy:
- Thank the customer for their feedback
- Address specific points mentioned in the review
- Show commitment to customer satisfaction
- Encourage future engagement`}},y=(e,t)=>{let s={short:"Response length: 1-2 sentences maximum. Be concise but impactful.",medium:"Response length: 2-3 sentences. Provide adequate detail and context.",long:"Response length: 3-4 sentences. Be comprehensive and detailed."},r=s[e]||s.medium;return"negative"===t.sentiment&&(r+=" For negative reviews, ensure the response is thorough enough to address concerns properly."),r},v=(e,t)=>{let s={short:100,medium:150,long:200}[e]||150;return"negative"===t.sentiment&&(s=Math.round(1.2*s)),s},w=(e,t,s)=>{let r=.7;switch(t){case"casual":r=.8;break;case"friendly":r=.75;break;case"formal":r=.6;break;case"professional":r=.65;break;case"empathetic":r=.7}return"negative"===e.sentiment?r=Math.max(.5,r-.1):"positive"===e.sentiment&&(r=Math.min(.9,r+.05)),s&&(r+=.05*s),r},x=(e,t,s)=>{let r=[],n=[],i=100,a=e.split(" ").length,o="short"===t.responseLength?10:"medium"===t.responseLength?25:40;a<.5*o?(r.push("Response is too short"),i-=15):a>2*o&&(r.push("Response is too long"),i-=10);let c=u(e,"5");"negative"===s.sentiment&&"positive"===c.sentiment?i+=5:"positive"===s.sentiment&&"negative"===c.sentiment&&(r.push("Response tone doesn't match positive review"),i-=20),A(t.businessType).some(t=>e.toLowerCase().includes(t))||(n.push("Consider adding more business-specific context"),i-=5),b(t.tone).some(t=>e.toLowerCase().includes(t))||(n.push("Consider adjusting tone to match requested style"),i-=10),e.includes("!")&&"formal"===t.tone&&(n.push("Consider using fewer exclamation marks for formal tone"),i-=5),e.includes("?")&&"negative"===s.sentiment&&(n.push("Avoid questions in responses to negative reviews"),i-=5);let l=t.text.toLowerCase().split(" ").filter(e=>e.length>3),d=e.toLowerCase().split(" ");return l.filter(e=>d.includes(e)).length<2&&(n.push("Consider referencing specific points from the review"),i-=10),["thank","appreciate","grateful","thanks"].some(t=>e.toLowerCase().includes(t))||(n.push("Consider adding a thank you or appreciation"),i-=5),{isValid:i>=70,score:Math.max(0,Math.min(100,i)),issues:r,suggestions:n}},A=e=>{let t={restaurant:["food","service","dining","meal","dish","chef","kitchen","menu"],retail:["product","shopping","store","purchase","item","selection","quality"],healthcare:["care","patient","medical","health","treatment","doctor","nurse"],professional:["service","professional","expertise","quality","work","project"],hospitality:["stay","guest","hotel","accommodation","comfort","service"],technology:["software","product","feature","technology","system","platform"],other:["service","experience","quality","business"]};return t[e]||t.other},b=e=>{let t={professional:["appreciate","regard","ensure","maintain","professional"],friendly:["happy","glad","pleased","welcome","friendly"],formal:["respectfully","sincerely","regards","formal","proper"],casual:["great","awesome","cool","nice","casual"],empathetic:["understand","feel","concern","care","empathy"]};return t[e]||t.professional},R=e=>{if(!e||1===e)return"";let t=["","Standard professional response","More conversational and friendly approach","Formal and detailed response","Brief and concise response","Emotional and empathetic response"];return`
Variation Style: ${t[Math.min(e,t.length-1)]}`},k=e=>e?`
Template Integration: Use the following template as a starting point and adapt it to the specific review:
"${e}"

Modify the template to address the specific feedback while maintaining the core message and tone.`:"",S=new c.ZP({apiKey:process.env.OPENAI_API_KEY,maxRetries:3,timeout:3e4}),T=new l.ZP({apiKey:process.env.ANTHROPIC_API_KEY}),P={requestsPerMinute:10,requestsPerHour:100},q={requests:[],lastCleanup:Date.now()},I=()=>{let e=Date.now(),t=e-36e5;q.requests=q.requests.filter(e=>e>t),q.lastCleanup=e},E=()=>{let e=Date.now(),t=e-6e4,s=e-36e5;e-q.lastCleanup>36e5&&I();let r=q.requests.filter(e=>e>t).length,n=q.requests.filter(e=>e>s).length;return r>=P.requestsPerMinute?{allowed:!1,message:"Rate limit exceeded: Too many requests per minute"}:n>=P.requestsPerHour?{allowed:!1,message:"Rate limit exceeded: Too many requests per hour"}:(q.requests.push(e),{allowed:!0})},C=async e=>{try{let t;let s=E();if(!s.allowed)return{response:"",error:s.message};let{provider:r="auto",variation:n=1,toneAdjustments:i={},useTemplate:a=null}=e,o=await j(r),c={text:e.reviewText,rating:e.rating,businessType:e.businessType,tone:e.tone,responseLength:e.responseLength,provider:o,variation:n,toneAdjustments:i,useTemplate:a},l=u(e.reviewText,e.rating),d=m(c);if("openai"===o)t=await N(d);else{if("claude"!==o)return{response:"",error:"No AI provider available"};t=await M(d)}let p=x(t.response,c,l);return{...t,validation:p}}catch(e){return console.error("AI Generation Error:",e),{response:"",error:"Failed to generate response. Please try again."}}},j=async e=>{if("auto"===e){let e=!!process.env.OPENAI_API_KEY,t=!!process.env.ANTHROPIC_API_KEY;if(e&&t)return"claude";if(e)return"openai";if(t)return"claude";throw Error("No AI provider configured")}if("openai"===e&&!process.env.OPENAI_API_KEY)throw Error("OpenAI API key not configured");if("claude"===e&&!process.env.ANTHROPIC_API_KEY)throw Error("Anthropic API key not configured");return e},N=async e=>{try{let t=await S.chat.completions.create({model:"gpt-4o",messages:[{role:"system",content:e.system},{role:"user",content:e.user}],max_tokens:e.maxTokens,temperature:e.temperature,presence_penalty:.1,frequency_penalty:.1}),s=t.choices[0]?.message?.content?.trim();if(!s)return{response:"",error:"No response generated from OpenAI"};return{response:s,provider:"openai"}}catch(e){if(console.error("OpenAI API Error:",e),e?.status===429)return{response:"",error:"Rate limit exceeded. Please try again in a moment."};if(e?.status===401)return{response:"",error:"Invalid OpenAI API key. Please check your configuration."};if(e?.status===402)return{response:"",error:"OpenAI API quota exceeded. Please check your account."};if(e?.code==="ECONNRESET"||e?.code==="ETIMEDOUT")return{response:"",error:"Connection timeout. Please try again."};return{response:"",error:"OpenAI API error. Please try again."}}},M=async e=>{try{let t=await T.messages.create({model:"claude-3-5-sonnet-20241022",max_tokens:e.maxTokens,temperature:e.temperature,system:e.system,messages:[{role:"user",content:e.user}]}),s=t.content[0]?.type==="text"?t.content[0].text.trim():"";if(!s)return{response:"",error:"No response generated from Claude"};return{response:s,provider:"claude"}}catch(e){if(console.error("Claude API Error:",e),e?.status===429)return{response:"",error:"Rate limit exceeded. Please try again in a moment."};if(e?.status===401)return{response:"",error:"Invalid Anthropic API key. Please check your configuration."};if(e?.status===402)return{response:"",error:"Anthropic API quota exceeded. Please check your account."};if(e?.code==="ECONNRESET"||e?.code==="ETIMEDOUT")return{response:"",error:"Connection timeout. Please try again."};return{response:"",error:"Claude API error. Please try again."}}},L=()=>({openai:!!process.env.OPENAI_API_KEY,claude:!!process.env.ANTHROPIC_API_KEY});class O{constructor(e={}){this.cache=new Map,this.maxSize=e.maxSize||100,this.defaultTTL=e.defaultTTL||3e5,this.loadFromStorage()}set(e,t,s){let r={data:t,timestamp:Date.now(),ttl:s||this.defaultTTL};if(this.cleanup(),this.cache.size>=this.maxSize){let e=Array.from(this.cache.keys())[0];e&&this.cache.delete(e)}this.cache.set(e,r),this.saveToStorage()}get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),this.saveToStorage(),null):t.data:null}has(e){return null!==this.get(e)}delete(e){let t=this.cache.delete(e);return t&&this.saveToStorage(),t}clear(){this.cache.clear(),this.saveToStorage()}size(){return this.cleanup(),this.cache.size}cleanup(){let e=Date.now();for(let[t,s]of Array.from(this.cache.entries()))e-s.timestamp>s.ttl&&this.cache.delete(t)}saveToStorage(){try{let e=Array.from(this.cache.entries());localStorage.setItem("response-cache",JSON.stringify(e))}catch(e){console.warn("Failed to save cache to localStorage:",e)}}loadFromStorage(){try{let e=localStorage.getItem("response-cache");if(e){let t=JSON.parse(e);this.cache=new Map(t),this.cleanup()}}catch(e){console.warn("Failed to load cache from localStorage:",e)}}static generateKey(e,t,s){let r=e.trim().toLowerCase(),n=t.toLowerCase(),i=s?`-${s}`:"";return`response-${btoa(r).slice(0,20)}-${n}${i}`}getStats(){return this.cleanup(),{size:this.cache.size,maxSize:this.maxSize,hitRate:0,memoryUsage:this.estimateMemoryUsage()}}estimateMemoryUsage(){try{let e=JSON.stringify(Array.from(this.cache.entries()));return new Blob([e]).size}catch{return 0}}}let z=new O({maxSize:50,defaultTTL:6e5});var F=s(7845);let D=(0,F.tF)((0,F.er)(F.VF)(async e=>{try{let t=await e.json(),{reviewText:s,rating:r,businessType:n,tone:i,responseLength:a,provider:c,variations:l=3,toneAdjustments:u={},useTemplate:d=null,skipCache:p=!1}=F.S2.sanitizeObject(t);if(!s||!r||!n||!i||!a)return o.NextResponse.json({error:"Missing required fields"},{status:400});let m=F.S2.sanitizeReviewText(s);if(m.trim().length<10)return o.NextResponse.json({error:"Review text must be at least 10 characters"},{status:400});if(m.trim().length>5e3)return o.NextResponse.json({error:"Review text must be less than 5000 characters"},{status:400});if(!F.cX.isValidRating(r))return o.NextResponse.json({error:"Invalid rating value"},{status:400});if(!F.cX.isValidBusinessType(n))return o.NextResponse.json({error:"Invalid business type"},{status:400});if(!F.cX.isValidTone(i))return o.NextResponse.json({error:"Invalid tone"},{status:400});if(!F.cX.isValidResponseLength(a))return o.NextResponse.json({error:"Invalid response length"},{status:400});if(c&&!F.cX.isValidProvider(c))return o.NextResponse.json({error:"Invalid AI provider"},{status:400});if(!F.cX.isValidVariations(l))return o.NextResponse.json({error:"Variations must be between 1 and 5"},{status:400});if(u&&"object"==typeof u){let e=["formality","empathy","enthusiasm","professionalism"];for(let t of Object.keys(u)){if(!e.includes(t))return o.NextResponse.json({error:`Invalid tone adjustment: ${t}`},{status:400});let s=u[t];if(!F.cX.isValidToneAdjustment(s))return o.NextResponse.json({error:`Tone adjustment ${t} must be a number between 0 and 10`},{status:400})}}let h=L();if(!h.openai&&!h.claude)return o.NextResponse.json({error:"No AI provider configured. Please set up OpenAI or Anthropic API keys."},{status:500});let g=O.generateKey(m,i,d);if(!p){let e=z.get(g);if(e&&e.metadata)return o.NextResponse.json({...e,metadata:{...e.metadata,cached:!0,cacheKey:g}})}let f=[],y=Math.min(l||3,5);for(let e=0;e<y;e++){let t=await C({reviewText:m.trim(),rating:r,businessType:n,tone:i,responseLength:a,provider:c||"auto",variation:e+1,toneAdjustments:u,useTemplate:d});if(t.error)return o.NextResponse.json({error:t.error},{status:500});f.push({id:e+1,text:t.response,provider:t.provider,validation:t.validation})}let v={responses:f,metadata:{reviewLength:m.length,rating:r,businessType:n,tone:i,responseLength:a,variations:y,toneAdjustments:u,useTemplate:d,timestamp:new Date().toISOString(),cached:!1}};return p||z.set(g,v),o.NextResponse.json(v)}catch(e){if(console.error("API Error:",e),e instanceof SyntaxError)return o.NextResponse.json({error:"Invalid JSON in request body"},{status:400});return o.NextResponse.json({error:"Internal server error"},{status:500})}}));async function $(){return o.NextResponse.json({error:"Method not allowed"},{status:405})}async function _(){return o.NextResponse.json({error:"Method not allowed"},{status:405})}async function V(){return o.NextResponse.json({error:"Method not allowed"},{status:405})}let X=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/generate-response/route",pathname:"/api/generate-response",filename:"route",bundlePath:"app/api/generate-response/route"},resolvedPagePath:"/Users/monicalacombe/review-response-generator/app/api/generate-response/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:U,staticGenerationAsyncStorage:K,serverHooks:B}=X,H="/api/generate-response/route";function Y(){return(0,a.patchFetch)({serverHooks:B,staticGenerationAsyncStorage:K})}},7845:(e,t,s)=>{s.d(t,{S2:()=>o,cX:()=>h,VF:()=>l,_g:()=>u,er:()=>m,tF:()=>p});let r=require("crypto");var n=s.n(r),i=s(7070);class a{static{this.algorithm="aes-256-gcm"}static{this.keyLength=32}static{this.ivLength=16}static{this.saltLength=64}static{this.tagLength=16}static encrypt(e,t){try{let s=n().randomBytes(this.saltLength),r=n().pbkdf2Sync(t,s,1e5,this.keyLength,"sha512"),i=n().randomBytes(this.ivLength),a=n().createCipher(this.algorithm,r),o=a.update(e,"utf8","hex");return o+=a.final("hex"),s.toString("hex")+":"+i.toString("hex")+":"+o}catch(e){throw console.error("Encryption error:",e),Error("Failed to encrypt data")}}static decrypt(e,t){try{let s=e.split(":");if(3!==s.length)throw Error("Invalid encrypted data format");let[r,i,a]=s,o=Buffer.from(r,"hex");Buffer.from(i,"hex");let c=n().pbkdf2Sync(t,o,1e5,this.keyLength,"sha512"),l=n().createDecipher(this.algorithm,c),u=l.update(a,"hex","utf8");return u+=l.final("utf8")}catch(e){throw console.error("Decryption error:",e),Error("Failed to decrypt data")}}}class o{static sanitizeString(e){return"string"!=typeof e?"":e.trim().replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").substring(0,1e4)}static sanitizeReviewText(e){return this.sanitizeString(e).replace(/[^\w\s.,!?-]/g,"").replace(/\s+/g," ")}static sanitizeEmail(e){if("string"!=typeof e)return"";let t=e.trim().toLowerCase();return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?t:""}static sanitizeObject(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map(e=>this.sanitizeObject(e));let t={};for(let[s,r]of Object.entries(e))"string"==typeof r?t[s]=this.sanitizeString(r):"object"==typeof r?t[s]=this.sanitizeObject(r):t[s]=r;return t}}class c{constructor(e){this.requests=new Map,this.config=e}isAllowed(e){let t=Date.now(),s=this.requests.get(e);return!s||t>s.resetTime?(this.requests.set(e,{count:1,resetTime:t+this.config.windowMs}),!0):!(s.count>=this.config.maxRequests)&&(s.count++,!0)}getRemainingRequests(e){let t=this.requests.get(e);return!t||Date.now()>t.resetTime?this.config.maxRequests:Math.max(0,this.config.maxRequests-t.count)}getResetTime(e){let t=this.requests.get(e);return t?t.resetTime:Date.now()+this.config.windowMs}cleanup(){let e=Date.now();for(let[t,s]of Array.from(this.requests.entries()))e>s.resetTime&&this.requests.delete(t)}}let l=new c({windowMs:6e4,maxRequests:30}),u=new c({windowMs:6e4,maxRequests:5});setInterval(()=>{l.cleanup(),u.cleanup()},3e5);let d={origin:process.env.ALLOWED_ORIGINS?.split(",")||["http://localhost:3000"],methods:["GET","POST","PUT","DELETE","OPTIONS"],allowedHeaders:["Content-Type","Authorization","X-Requested-With"],credentials:!0,maxAge:86400};function p(e){return async t=>{let s=await e(t);if(s instanceof i.NextResponse){s.headers.set("X-Content-Type-Options","nosniff"),s.headers.set("X-Frame-Options","DENY"),s.headers.set("X-XSS-Protection","1; mode=block"),s.headers.set("Referrer-Policy","strict-origin-when-cross-origin"),s.headers.set("Permissions-Policy","camera=(), microphone=(), geolocation=()");let e=t.headers.get("origin");e&&d.origin.includes(e)&&s.headers.set("Access-Control-Allow-Origin",e),s.headers.set("Access-Control-Allow-Methods",d.methods.join(", ")),s.headers.set("Access-Control-Allow-Headers",d.allowedHeaders.join(", ")),s.headers.set("Access-Control-Allow-Credentials","true"),s.headers.set("Access-Control-Max-Age",d.maxAge.toString())}return s}}function m(e,t){return s=>async r=>{let n=t?t(r):r.ip||r.headers.get("x-forwarded-for")||"unknown";if(!e.isAllowed(n))return i.NextResponse.json({error:"Rate limit exceeded",retryAfter:Math.ceil((e.getResetTime(n)-Date.now())/1e3)},{status:429,headers:{"X-RateLimit-Limit":"30","X-RateLimit-Remaining":"0","X-RateLimit-Reset":e.getResetTime(n).toString(),"Retry-After":Math.ceil((e.getResetTime(n)-Date.now())/1e3).toString()}});let a=await s(r);return a instanceof i.NextResponse&&(a.headers.set("X-RateLimit-Limit","30"),a.headers.set("X-RateLimit-Remaining",e.getRemainingRequests(n).toString()),a.headers.set("X-RateLimit-Reset",e.getResetTime(n).toString())),a}}class h{static isValidRating(e){return["1","2","3","4","5"].includes(String(e))}static isValidBusinessType(e){return["restaurant","retail","healthcare","professional","hospitality","technology","other"].includes(String(e))}static isValidTone(e){return["professional","friendly","formal","casual","empathetic"].includes(String(e))}static isValidResponseLength(e){return["short","medium","long"].includes(String(e))}static isValidProvider(e){return["openai","claude","auto"].includes(String(e))}static isValidVariations(e){let t=parseInt(String(e));return!isNaN(t)&&t>=1&&t<=5}static isValidToneAdjustment(e){let t=parseFloat(String(e));return!isNaN(t)&&t>=0&&t<=10}}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,972,397],()=>s(6949));module.exports=r})();