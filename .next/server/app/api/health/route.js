"use strict";(()=>{var e={};e.id=829,e.ids=[829],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},272:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>u,serverHooks:()=>d,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>c,OPTIONS:()=>p});var i=r(9303),n=r(8716),a=r(670),o=r(7070);class h{logError(e,t){let r={id:this.generateId(),timestamp:new Date().toISOString(),level:"error",message:"string"==typeof e?e:e.message,stack:e instanceof Error?e.stack:void 0,context:t,url:void 0,userAgent:void 0};this.errors.push(r),this.trimEvents(this.errors),this.sendToMonitoringService(r)}logWarning(e,t){let r={id:this.generateId(),timestamp:new Date().toISOString(),level:"warn",message:e,context:t,url:void 0,userAgent:void 0};this.errors.push(r),this.trimEvents(this.errors)}logInfo(e,t){let r={id:this.generateId(),timestamp:new Date().toISOString(),level:"info",message:e,context:t,url:void 0,userAgent:void 0};this.errors.push(r),this.trimEvents(this.errors)}logPerformance(e,t,r,s){let i={id:this.generateId(),timestamp:new Date().toISOString(),type:e,name:t,duration:r,metadata:s};this.performance.push(i),this.trimEvents(this.performance)}logSecurityEvent(e,t,r){let s={id:this.generateId(),timestamp:new Date().toISOString(),type:e,details:t,context:r};this.security.push(s),this.trimEvents(this.security),this.sendToMonitoringService(s,"security")}logRateLimit(e,t,r){this.logSecurityEvent("rate_limit",`Rate limit exceeded for IP ${e} on endpoint ${t}`,{ip:e,endpoint:t,limit:r})}logXssAttempt(e,t){this.logSecurityEvent("xss_attempt","XSS attempt detected and sanitized",{originalInput:e,sanitizedInput:t})}logInvalidInput(e,t,r){this.logSecurityEvent("invalid_input",`Invalid input for field ${e}`,{field:e,value:t,validation:r})}trackApiCall(e,t,r,s){this.logPerformance("api_call",`${t} ${e}`,r,{endpoint:e,method:t,statusCode:s})}trackPageLoad(e,t){this.logPerformance("page_load",e,t,{page:e})}trackUserAction(e,t,r){this.logPerformance("user_action",e,t,r)}getErrors(e=100){return this.errors.slice(-e)}getPerformance(e=100){return this.performance.slice(-e)}getSecurityEvents(e=100){return this.security.slice(-e)}getStats(){let e=new Date,t=new Date(e.getTime()-36e5),r=new Date(e.getTime()-864e5),s=this.errors.filter(e=>new Date(e.timestamp)>t),i=this.security.filter(e=>new Date(e.timestamp)>t),n=this.performance.filter(e=>new Date(e.timestamp)>t);return{total:{errors:this.errors.length,security:this.security.length,performance:this.performance.length},recent:{errors:s.length,security:i.length,performance:n.length},hourly:{errors:s.length,security:i.length,performance:n.length},daily:{errors:this.errors.filter(e=>new Date(e.timestamp)>r).length,security:this.security.filter(e=>new Date(e.timestamp)>r).length,performance:this.performance.filter(e=>new Date(e.timestamp)>r).length}}}clearEvents(){this.errors=[],this.performance=[],this.security=[]}generateId(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}trimEvents(e){e.length>this.maxEvents&&e.splice(0,e.length-this.maxEvents)}async sendToMonitoringService(e,t="error"){try{process.env.MONITORING_ENDPOINT&&await fetch(process.env.MONITORING_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:t,event:e,timestamp:new Date().toISOString()})})}catch(e){console.error("Failed to send to monitoring service:",e)}}constructor(){this.errors=[],this.performance=[],this.security=[],this.maxEvents=1e3}}let l=new h;async function c(e){try{let e=Date.now(),t={status:"healthy",timestamp:new Date().toISOString(),version:process.env.npm_package_version||"1.0.0",environment:"production",uptime:process.uptime(),memory:process.memoryUsage(),checks:{api:"healthy",database:"healthy",redis:"healthy",external_apis:"healthy"}};try{process.env.OPENAI_API_KEY&&!(await fetch("https://api.openai.com/v1/models",{headers:{Authorization:`Bearer ${process.env.OPENAI_API_KEY}`,"Content-Type":"application/json"}})).ok&&(t.checks.external_apis="degraded")}catch(e){t.checks.external_apis="unhealthy",l.logError("Health check: External API connectivity failed",{error:e})}if(Object.entries(t.checks).filter(([e,t])=>"unhealthy"===t).map(([e])=>e).length>0)return t.status="unhealthy",o.NextResponse.json(t,{status:503});Object.entries(t.checks).filter(([e,t])=>"degraded"===t).map(([e])=>e).length>0&&(t.status="degraded");let r=Date.now()-e;t.responseTime=r;let s=o.NextResponse.json(t,{status:"healthy"===t.status?200:503});return s.headers.set("X-Response-Time",`${r}ms`),s.headers.set("Cache-Control","no-cache, no-store, must-revalidate"),s}catch(e){return l.logError("Health check failed",{error:e}),o.NextResponse.json({status:"unhealthy",timestamp:new Date().toISOString(),error:"Health check failed",checks:{api:"unhealthy"}},{status:503})}}async function p(e){return new o.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let u=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/health/route",pathname:"/api/health",filename:"route",bundlePath:"app/api/health/route"},resolvedPagePath:"/Users/monicalacombe/review-response-generator/app/api/health/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:d}=u,v="/api/health/route";function y(){return(0,a.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:g})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972],()=>r(272));module.exports=s})();