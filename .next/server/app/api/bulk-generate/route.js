"use strict";(()=>{var e={};e.id=239,e.ids=[239],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},5315:e=>{e.exports=require("path")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},2623:e=>{e.exports=require("worker_threads")},1568:e=>{e.exports=require("zlib")},7561:e=>{e.exports=require("node:fs")},4492:e=>{e.exports=require("node:stream")},2477:e=>{e.exports=require("node:stream/web")},4374:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>$,patchFetch:()=>F,requestAsyncStorage:()=>D,routeModule:()=>N,serverHooks:()=>C,staticGenerationAsyncStorage:()=>O});var s={};r.r(s),r.d(s,{POST:()=>j});var n=r(9303),o=r(8716),i=r(670),a=r(7070);let u=new(r(4214)).ZP({apiKey:process.env.OPENAI_API_KEY,maxRetries:3,timeout:3e4}),l={requestsPerMinute:10,requestsPerHour:100},c={requests:[],lastCleanup:Date.now()},p=()=>{let e=Date.now(),t=e-36e5;c.requests=c.requests.filter(e=>e>t),c.lastCleanup=e},d=()=>{let e=Date.now(),t=e-6e4,r=e-36e5;e-c.lastCleanup>36e5&&p();let s=c.requests.filter(e=>e>t).length,n=c.requests.filter(e=>e>r).length;return s>=l.requestsPerMinute?{allowed:!1,message:"Rate limit exceeded: Too many requests per minute"}:n>=l.requestsPerHour?{allowed:!1,message:"Rate limit exceeded: Too many requests per hour"}:(c.requests.push(e),{allowed:!0})},h=async e=>{try{let t=d();if(!t.allowed)return{response:"",error:t.message};if(!process.env.OPENAI_API_KEY)return{response:"",error:"OpenAI API key not configured"};let r=m(e),s=await u.chat.completions.create({model:"gpt-4",messages:[{role:"system",content:`You are a professional customer service representative who writes thoughtful, authentic responses to customer reviews. Your responses should be:
- Appropriate for the business type and industry
- Match the specified tone (professional, friendly, formal, casual, or empathetic)
- Address the specific feedback in the review
- Be the specified length (short: 1-2 sentences, medium: 2-3 sentences, long: 3-4 sentences)
- Genuine and authentic, not generic
- Thank the customer for their feedback
- Show appreciation for their business
- Encourage future engagement when appropriate`},{role:"user",content:r}],max_tokens:w(e.responseLength),temperature:.7,presence_penalty:.1,frequency_penalty:.1}),n=s.choices[0]?.message?.content?.trim();if(!n)return{response:"",error:"No response generated from OpenAI"};return{response:n}}catch(e){if(console.error("OpenAI API Error:",e),e?.status===429)return{response:"",error:"Rate limit exceeded. Please try again in a moment."};if(e?.status===401)return{response:"",error:"Invalid API key. Please check your configuration."};if(e?.status===402)return{response:"",error:"API quota exceeded. Please check your OpenAI account."};if(e?.code==="ECONNRESET"||e?.code==="ETIMEDOUT")return{response:"",error:"Connection timeout. Please try again."};return{response:"",error:"Failed to generate response. Please try again."}}},m=e=>{let{reviewText:t,rating:r,businessType:s,tone:n,responseLength:o}=e,i=f(s),a=g(n),u=y(o);return`Please write a ${n} response to this ${r}-star review for a ${s} business:

Review: "${t}"

Business Context: ${i}
Tone: ${a}
Length: ${u}

Write a response that addresses the specific feedback while maintaining the appropriate tone and length.`},f=e=>{let t={restaurant:"Restaurant/food service business. Focus on food quality, service, atmosphere, and dining experience.",retail:"Retail/e-commerce business. Focus on products, customer service, shopping experience, and value.",healthcare:"Healthcare/medical business. Focus on patient care, professionalism, and medical expertise.",professional:"Professional services business. Focus on expertise, reliability, and professional standards.",hospitality:"Hospitality/travel business. Focus on guest experience, accommodations, and service quality.",technology:"Technology/software business. Focus on product functionality, support, and innovation.",other:"General business. Focus on customer satisfaction and service quality."};return t[e]||t.other},g=e=>{let t={professional:"Use formal, business-appropriate language. Be courteous and professional.",friendly:"Use warm, approachable language. Be personable and welcoming.",formal:"Use very formal, corporate language. Be respectful and proper.",casual:"Use relaxed, conversational language. Be approachable and informal.",empathetic:"Show understanding and compassion. Acknowledge feelings and concerns."};return t[e]||t.professional},y=e=>{let t={short:"Keep it brief: 1-2 sentences maximum.",medium:"Moderate length: 2-3 sentences.",long:"Detailed response: 3-4 sentences."};return t[e]||t.medium},w=e=>({short:100,medium:150,long:200})[e]||150,x=new(r(7534)).ZP({apiKey:process.env.ANTHROPIC_API_KEY}),v={requestsPerMinute:10,requestsPerHour:100},R={requests:[],lastCleanup:Date.now()},b=()=>{let e=Date.now(),t=e-36e5;R.requests=R.requests.filter(e=>e>t),R.lastCleanup=e},q=()=>{let e=Date.now(),t=e-6e4,r=e-36e5;e-R.lastCleanup>36e5&&b();let s=R.requests.filter(e=>e>t).length,n=R.requests.filter(e=>e>r).length;return s>=v.requestsPerMinute?{allowed:!1,message:"Rate limit exceeded: Too many requests per minute"}:n>=v.requestsPerHour?{allowed:!1,message:"Rate limit exceeded: Too many requests per hour"}:(R.requests.push(e),{allowed:!0})},A=async e=>{try{let t=q();if(!t.allowed)return{response:"",error:t.message};if(!process.env.ANTHROPIC_API_KEY)return{response:"",error:"Anthropic API key not configured"};let r=P(e),s=await x.messages.create({model:"claude-3-sonnet-20240229",max_tokens:S(e.responseLength),temperature:.7,system:`You are a professional customer service representative who writes thoughtful, authentic responses to customer reviews. Your responses should be:
- Appropriate for the business type and industry
- Match the specified tone (professional, friendly, formal, casual, or empathetic)
- Address the specific feedback in the review
- Be the specified length (short: 1-2 sentences, medium: 2-3 sentences, long: 3-4 sentences)
- Genuine and authentic, not generic
- Thank the customer for their feedback
- Show appreciation for their business
- Encourage future engagement when appropriate

Always respond with just the review response text, no additional formatting or explanations.`,messages:[{role:"user",content:r}]}),n=s.content[0]?.type==="text"?s.content[0].text.trim():"";if(!n)return{response:"",error:"No response generated from Claude"};return{response:n}}catch(e){if(console.error("Claude API Error:",e),e?.status===429)return{response:"",error:"Rate limit exceeded. Please try again in a moment."};if(e?.status===401)return{response:"",error:"Invalid API key. Please check your configuration."};if(e?.status===402)return{response:"",error:"API quota exceeded. Please check your Anthropic account."};if(e?.code==="ECONNRESET"||e?.code==="ETIMEDOUT")return{response:"",error:"Connection timeout. Please try again."};return{response:"",error:"Failed to generate response. Please try again."}}},P=e=>{let{reviewText:t,rating:r,businessType:s,tone:n,responseLength:o}=e,i=T(s),a=I(n),u=k(o);return`Please write a ${n} response to this ${r}-star review for a ${s} business:

Review: "${t}"

Business Context: ${i}
Tone: ${a}
Length: ${u}

Write a response that addresses the specific feedback while maintaining the appropriate tone and length.`},T=e=>{let t={restaurant:"Restaurant/food service business. Focus on food quality, service, atmosphere, and dining experience.",retail:"Retail/e-commerce business. Focus on products, customer service, shopping experience, and value.",healthcare:"Healthcare/medical business. Focus on patient care, professionalism, and medical expertise.",professional:"Professional services business. Focus on expertise, reliability, and professional standards.",hospitality:"Hospitality/travel business. Focus on guest experience, accommodations, and service quality.",technology:"Technology/software business. Focus on product functionality, support, and innovation.",other:"General business. Focus on customer satisfaction and service quality."};return t[e]||t.other},I=e=>{let t={professional:"Use formal, business-appropriate language. Be courteous and professional.",friendly:"Use warm, approachable language. Be personable and welcoming.",formal:"Use very formal, corporate language. Be respectful and proper.",casual:"Use relaxed, conversational language. Be approachable and informal.",empathetic:"Show understanding and compassion. Acknowledge feelings and concerns."};return t[e]||t.professional},k=e=>{let t={short:"Keep it brief: 1-2 sentences maximum.",medium:"Moderate length: 2-3 sentences.",long:"Detailed response: 3-4 sentences."};return t[e]||t.medium},S=e=>({short:100,medium:150,long:200})[e]||150;var E=r(7845);let j=(0,E.tF)((0,E.er)(E._g)(async e=>{try{let t=await e.json(),{responses:r}=E.S2.sanitizeObject(t);if(!r||!Array.isArray(r)||0===r.length)return a.NextResponse.json({error:"No responses provided for bulk generation"},{status:400});if(r.length>10)return a.NextResponse.json({error:"Maximum 10 responses allowed for bulk generation"},{status:400});for(let e of r){let{review:t,rating:r,businessType:s,tone:n,responseLength:o,provider:i,toneAdjustments:u}=e,l=E.S2.sanitizeReviewText(t);if(l.trim().length<10)return a.NextResponse.json({error:`Review text for ID ${e.id} must be at least 10 characters`},{status:400});if(l.trim().length>5e3)return a.NextResponse.json({error:`Review text for ID ${e.id} must be less than 5000 characters`},{status:400});if(!E.cX.isValidRating(r))return a.NextResponse.json({error:`Invalid rating value for ID ${e.id}`},{status:400});if(!E.cX.isValidBusinessType(s))return a.NextResponse.json({error:`Invalid business type for ID ${e.id}`},{status:400});if(!E.cX.isValidTone(n))return a.NextResponse.json({error:`Invalid tone for ID ${e.id}`},{status:400});if(!E.cX.isValidResponseLength(o))return a.NextResponse.json({error:`Invalid response length for ID ${e.id}`},{status:400});if(i&&!E.cX.isValidProvider(i))return a.NextResponse.json({error:`Invalid AI provider for ID ${e.id}`},{status:400});if(u&&"object"==typeof u){let t=["formality","empathy","enthusiasm","professionalism"];for(let r of Object.keys(u)){if(!t.includes(r))return a.NextResponse.json({error:`Invalid tone adjustment ${r} for ID ${e.id}`},{status:400});let s=u[r];if(!E.cX.isValidToneAdjustment(s))return a.NextResponse.json({error:`Tone adjustment ${r} for ID ${e.id} must be a number between 0 and 10`},{status:400})}}}let s=[];for(let e of r)try{let t,r;let{review:n,rating:o,businessType:i,tone:a,responseLength:u,provider:l="auto",toneAdjustments:c}=e,p=E.S2.sanitizeReviewText(n),d=l;"auto"===l&&(d="long"===u?"claude":"openai");let m=Date.now();if("claude"===d){let e=await A({reviewText:p,rating:o,businessType:i,tone:a,responseLength:u});if(e.error)throw Error(e.error);t=e.response}else{let e=await h({reviewText:p,rating:o,businessType:i,tone:a,responseLength:u});if(e.error)throw Error(e.error);t=e.response}r=(Date.now()-m)/1e3,s.push({id:e.id,success:!0,response:t,provider:d,generationTime:r})}catch(t){console.error(`Error generating response for ID ${e.id}:`,t),s.push({id:e.id,success:!1,error:t instanceof Error?t.message:"Unknown error occurred"})}return a.NextResponse.json({success:!0,results:s,summary:{total:r.length,successful:s.filter(e=>e.success).length,failed:s.filter(e=>!e.success).length}})}catch(e){if(console.error("Bulk generation error:",e),e instanceof SyntaxError)return a.NextResponse.json({error:"Invalid JSON in request body"},{status:400});return a.NextResponse.json({error:"Failed to process bulk generation request"},{status:500})}})),N=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/bulk-generate/route",pathname:"/api/bulk-generate",filename:"route",bundlePath:"app/api/bulk-generate/route"},resolvedPagePath:"/Users/monicalacombe/review-response-generator/app/api/bulk-generate/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:D,staticGenerationAsyncStorage:O,serverHooks:C}=N,$="/api/bulk-generate/route";function F(){return(0,i.patchFetch)({serverHooks:C,staticGenerationAsyncStorage:O})}},7845:(e,t,r)=>{r.d(t,{S2:()=>a,cX:()=>m,VF:()=>l,_g:()=>c,er:()=>h,tF:()=>d});let s=require("crypto");var n=r.n(s),o=r(7070);class i{static{this.algorithm="aes-256-gcm"}static{this.keyLength=32}static{this.ivLength=16}static{this.saltLength=64}static{this.tagLength=16}static encrypt(e,t){try{let r=n().randomBytes(this.saltLength),s=n().pbkdf2Sync(t,r,1e5,this.keyLength,"sha512"),o=n().randomBytes(this.ivLength),i=n().createCipher(this.algorithm,s),a=i.update(e,"utf8","hex");return a+=i.final("hex"),r.toString("hex")+":"+o.toString("hex")+":"+a}catch(e){throw console.error("Encryption error:",e),Error("Failed to encrypt data")}}static decrypt(e,t){try{let r=e.split(":");if(3!==r.length)throw Error("Invalid encrypted data format");let[s,o,i]=r,a=Buffer.from(s,"hex");Buffer.from(o,"hex");let u=n().pbkdf2Sync(t,a,1e5,this.keyLength,"sha512"),l=n().createDecipher(this.algorithm,u),c=l.update(i,"hex","utf8");return c+=l.final("utf8")}catch(e){throw console.error("Decryption error:",e),Error("Failed to decrypt data")}}}class a{static sanitizeString(e){return"string"!=typeof e?"":e.trim().replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").substring(0,1e4)}static sanitizeReviewText(e){return this.sanitizeString(e).replace(/[^\w\s.,!?-]/g,"").replace(/\s+/g," ")}static sanitizeEmail(e){if("string"!=typeof e)return"";let t=e.trim().toLowerCase();return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?t:""}static sanitizeObject(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map(e=>this.sanitizeObject(e));let t={};for(let[r,s]of Object.entries(e))"string"==typeof s?t[r]=this.sanitizeString(s):"object"==typeof s?t[r]=this.sanitizeObject(s):t[r]=s;return t}}class u{constructor(e){this.requests=new Map,this.config=e}isAllowed(e){let t=Date.now(),r=this.requests.get(e);return!r||t>r.resetTime?(this.requests.set(e,{count:1,resetTime:t+this.config.windowMs}),!0):!(r.count>=this.config.maxRequests)&&(r.count++,!0)}getRemainingRequests(e){let t=this.requests.get(e);return!t||Date.now()>t.resetTime?this.config.maxRequests:Math.max(0,this.config.maxRequests-t.count)}getResetTime(e){let t=this.requests.get(e);return t?t.resetTime:Date.now()+this.config.windowMs}cleanup(){let e=Date.now();for(let[t,r]of Array.from(this.requests.entries()))e>r.resetTime&&this.requests.delete(t)}}let l=new u({windowMs:6e4,maxRequests:30}),c=new u({windowMs:6e4,maxRequests:5});setInterval(()=>{l.cleanup(),c.cleanup()},3e5);let p={origin:process.env.ALLOWED_ORIGINS?.split(",")||["http://localhost:3000"],methods:["GET","POST","PUT","DELETE","OPTIONS"],allowedHeaders:["Content-Type","Authorization","X-Requested-With"],credentials:!0,maxAge:86400};function d(e){return async t=>{let r=await e(t);if(r instanceof o.NextResponse){r.headers.set("X-Content-Type-Options","nosniff"),r.headers.set("X-Frame-Options","DENY"),r.headers.set("X-XSS-Protection","1; mode=block"),r.headers.set("Referrer-Policy","strict-origin-when-cross-origin"),r.headers.set("Permissions-Policy","camera=(), microphone=(), geolocation=()");let e=t.headers.get("origin");e&&p.origin.includes(e)&&r.headers.set("Access-Control-Allow-Origin",e),r.headers.set("Access-Control-Allow-Methods",p.methods.join(", ")),r.headers.set("Access-Control-Allow-Headers",p.allowedHeaders.join(", ")),r.headers.set("Access-Control-Allow-Credentials","true"),r.headers.set("Access-Control-Max-Age",p.maxAge.toString())}return r}}function h(e,t){return r=>async s=>{let n=t?t(s):s.ip||s.headers.get("x-forwarded-for")||"unknown";if(!e.isAllowed(n))return o.NextResponse.json({error:"Rate limit exceeded",retryAfter:Math.ceil((e.getResetTime(n)-Date.now())/1e3)},{status:429,headers:{"X-RateLimit-Limit":"30","X-RateLimit-Remaining":"0","X-RateLimit-Reset":e.getResetTime(n).toString(),"Retry-After":Math.ceil((e.getResetTime(n)-Date.now())/1e3).toString()}});let i=await r(s);return i instanceof o.NextResponse&&(i.headers.set("X-RateLimit-Limit","30"),i.headers.set("X-RateLimit-Remaining",e.getRemainingRequests(n).toString()),i.headers.set("X-RateLimit-Reset",e.getResetTime(n).toString())),i}}class m{static isValidRating(e){return["1","2","3","4","5"].includes(String(e))}static isValidBusinessType(e){return["restaurant","retail","healthcare","professional","hospitality","technology","other"].includes(String(e))}static isValidTone(e){return["professional","friendly","formal","casual","empathetic"].includes(String(e))}static isValidResponseLength(e){return["short","medium","long"].includes(String(e))}static isValidProvider(e){return["openai","claude","auto"].includes(String(e))}static isValidVariations(e){let t=parseInt(String(e));return!isNaN(t)&&t>=1&&t<=5}static isValidToneAdjustment(e){let t=parseFloat(String(e));return!isNaN(t)&&t>=0&&t<=10}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972,397],()=>r(4374));module.exports=s})();